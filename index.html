<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darcy's Meal Plans - Mediterranean Wellness for Life</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #7FB3D3;
            --soft-blue: #B8D4E3;
            --olive-green: #8FBC8F;
            --sage-green: #9CAF88;
            --cream-white: #FEFEFE;
            --warm-white: #F8F9FA;
            --text-dark: #2C3E50;
            --text-light: #5D6D7E;
            --accent-gold: #D4AF37;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, var(--warm-white) 0%, var(--soft-blue) 100%);
            color: var(--text-dark);
            line-height: 1.6;
            font-size: 18px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--cream-white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--olive-green);
        }

        .logo h1 {
            font-size: 2.2rem;
            color: var(--text-dark);
            font-weight: 300;
        }

        .accessibility-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-accessibility {
            background: var(--soft-blue);
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-accessibility:hover {
            background: var(--primary-blue);
            color: white;
        }

        /* Navigation */
        nav {
            background: var(--olive-green);
            padding: 15px 0;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: var(--olive-green);
        }

        /* Main Content */
        main {
            padding: 40px 0;
            min-height: calc(100vh - 200px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Homepage */
        .welcome-card {
            background: var(--cream-white);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .welcome-card h2 {
            font-size: 2.5rem;
            color: var(--olive-green);
            margin-bottom: 20px;
        }

        .welcome-card p {
            font-size: 1.3rem;
            color: var(--text-light);
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .dashboard-card {
            background: var(--cream-white);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card i {
            font-size: 3rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        .dashboard-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .tip-of-day {
            background: linear-gradient(135deg, var(--sage-green), var(--olive-green));
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .tip-of-day h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .calendar-nav button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .calendar-nav button:hover {
            background: var(--olive-green);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .calendar-day {
            background: var(--cream-white);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .calendar-day:hover {
            background: var(--soft-blue);
        }

        .calendar-day.selected {
            background: var(--olive-green);
            color: white;
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .meal-indicators {
            display: flex;
            justify-content: center;
            gap: 3px;
            flex-wrap: wrap;
        }

        .meal-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-gold);
        }

        /* Meal Planning Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--cream-white);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .meal-section {
            margin-bottom: 25px;
        }

        .meal-section h4 {
            font-size: 1.3rem;
            color: var(--olive-green);
            margin-bottom: 10px;
        }

        .meal-options {
            display: grid;
            gap: 10px;
        }

        .meal-option {
            background: var(--warm-white);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meal-option:hover {
            border-color: var(--primary-blue);
        }

        .meal-option.selected {
            border-color: var(--olive-green);
            background: var(--soft-blue);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--accent-gold);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .favorite-btn.favorited {
            color: #ff6b6b;
        }

        /* Buttons */
        .btn-primary {
            background: var(--olive-green);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary:hover {
            background: var(--sage-green);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--soft-blue);
        }

        /* Shopping List */
        .shopping-list {
            background: var(--cream-white);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
        }

        .shopping-category {
            margin-bottom: 25px;
        }

        .shopping-category h4 {
            color: var(--olive-green);
            font-size: 1.3rem;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--soft-blue);
            padding-bottom: 5px;
        }

        .shopping-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        /* Favorites */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .favorite-card {
            background: var(--cream-white);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .favorite-card h4 {
            color: var(--olive-green);
            margin-bottom: 10px;
        }

        /* Wellness Tips */
        .wellness-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .wellness-card {
            background: var(--cream-white);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .wellness-card h3 {
            color: var(--olive-green);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .wellness-card i {
            font-size: 2rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .logo h1 {
                font-size: 1.8rem;
            }

            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }

            .calendar-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            body {
                font-size: 16px;
            }
        }

        /* High Contrast Mode */
        .high-contrast {
            filter: contrast(150%) brightness(120%);
        }

        /* Large Font Mode */
        .large-font {
            font-size: 1.2em;
        }

        .large-font .logo h1 {
            font-size: 2.6rem;
        }

        .large-font .welcome-card h2 {
            font-size: 3rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    <h1>Darcy's Meal Plans</h1>
                </div>
                <div class="accessibility-controls">
                    <button class="btn-accessibility" onclick="toggleFontSize()">
                        <i class="fas fa-text-height"></i> Font Size
                    </button>
                    <button class="btn-accessibility" onclick="toggleContrast()">
                        <i class="fas fa-adjust"></i> Contrast
                    </button>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('home')">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="nav-btn" onclick="showSection('calendar')">
                    <i class="fas fa-calendar-alt"></i> Plan My Week
                </button>
                <button class="nav-btn" onclick="showSection('favorites')">
                    <i class="fas fa-heart"></i> Favorites
                </button>
                <button class="nav-btn" onclick="showSection('wellness')">
                    <i class="fas fa-spa"></i> Wellness Tips
                </button>
                <button class="nav-btn" onclick="showSection('shopping')">
                    <i class="fas fa-shopping-list"></i> Shopping List
                </button>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <!-- Home Section -->
            <section id="home" class="section active">
                <div class="welcome-card">
                    <h2>Welcome to Your Wellness Journey</h2>
                    <p>Discover the joy of Mediterranean-inspired healthy eating designed specifically for mature women. Plan your meals, track your favorites, and embrace a lifestyle of wellness and vitality.</p>
                    
                    <div class="dashboard-grid">
                        <div class="dashboard-card" onclick="showSection('calendar')">
                            <i class="fas fa-calendar-week"></i>
                            <h3>Plan My Week</h3>
                            <p>Create personalized meal plans with Mediterranean-inspired healthy options</p>
                        </div>
                        <div class="dashboard-card" onclick="showSection('favorites')">
                            <i class="fas fa-heart"></i>
                            <h3>My Favorites</h3>
                            <p>Quick access to your saved meals and preferred recipes</p>
                        </div>
                        <div class="dashboard-card" onclick="showSection('wellness')">
                            <i class="fas fa-leaf"></i>
                            <h3>Wellness Tips</h3>
                            <p>Daily inspiration for healthy living, gentle exercises, and self-care</p>
                        </div>
                    </div>
                </div>

                <div class="tip-of-day">
                    <h3><i class="fas fa-lightbulb"></i> Today's Wellness Tip</h3>
                    <p id="daily-tip">Start your day with a glass of warm water with lemon to boost hydration and support digestion. This simple Mediterranean tradition can help energize your morning naturally.</p>
                </div>
            </section>

            <!-- Calendar Section -->
            <section id="calendar" class="section">
                <div class="calendar-header">
                    <h2>Weekly Meal Planner</h2>
                    <div class="calendar-nav">
                        <button onclick="previousWeek()"><i class="fas fa-chevron-left"></i></button>
                        <h3 id="current-week">Week of January 15, 2025</h3>
                        <button onclick="nextWeek()"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <button class="btn-primary" onclick="surpriseMe()">
                        <i class="fas fa-magic"></i> Surprise Me This Week
                    </button>
                </div>

                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="generateShoppingList()">
                        <i class="fas fa-shopping-cart"></i> Generate Shopping List
                    </button>
                </div>
            </section>

            <!-- Favorites Section -->
            <section id="favorites" class="section">
                <h2 style="margin-bottom: 30px; text-align: center; color: var(--olive-green);">My Favorite Meals</h2>
                <div class="favorites-grid" id="favorites-grid">
                    <!-- Favorites will be populated by JavaScript -->
                </div>
            </section>

            <!-- Wellness Section -->
            <section id="wellness" class="section">
                <h2 style="margin-bottom: 30px; text-align: center; color: var(--olive-green);">Wellness & Exercise Tips</h2>
                <div class="wellness-grid">
                    <div class="wellness-card">
                        <i class="fas fa-walking"></i>
                        <h3>Gentle Morning Walk</h3>
                        <p>Start with a 10-15 minute walk around your neighborhood. Fresh air and gentle movement help boost energy and mood while supporting joint health.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">Watch Video Guide</button>
                    </div>
                    <div class="wellness-card">
                        <i class="fas fa-meditation"></i>
                        <h3>Chair Yoga Sequence</h3>
                        <p>Perfect for any fitness level, these seated stretches improve flexibility, reduce stiffness, and promote relaxation. Great for morning or evening routines.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">Try Now</button>
                    </div>
                    <div class="wellness-card">
                        <i class="fas fa-tint"></i>
                        <h3>Hydration Reminder</h3>
                        <p>Aim for 8 glasses of water daily. Add cucumber, mint, or lemon for variety. Proper hydration supports skin health, digestion, and energy levels.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">Set Reminders</button>
                    </div>
                    <div class="wellness-card">
                        <i class="fas fa-moon"></i>
                        <h3>Better Sleep Tips</h3>
                        <p>Create a calming bedtime routine: dim lights 1 hour before bed, try chamomile tea, and keep your bedroom cool and comfortable.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">Learn More</button>
                    </div>
                    <div class="wellness-card">
                        <i class="fas fa-heart"></i>
                        <h3>Heart-Healthy Foods</h3>
                        <p>Incorporate omega-3 rich foods like salmon, walnuts, and olive oil. These Mediterranean staples support cardiovascular health and brain function.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">View Recipes</button>
                    </div>
                    <div class="wellness-card">
                        <i class="fas fa-bone"></i>
                        <h3>Bone Health Support</h3>
                        <p>Include calcium-rich foods like Greek yogurt, leafy greens, and almonds. Gentle weight-bearing exercises help maintain bone density.</p>
                        <button class="btn-secondary" style="margin-top: 15px;">Exercise Guide</button>
                    </div>
                </div>
            </section>

            <!-- Shopping List Section -->
            <section id="shopping" class="section">
                <h2 style="margin-bottom: 30px; text-align: center; color: var(--olive-green);">Weekly Shopping List</h2>
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="btn-primary" onclick="generateShoppingList()">
                        <i class="fas fa-refresh"></i> Update List
                    </button>
                    <button class="btn-secondary" onclick="printShoppingList()" style="margin-left: 15px;">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn-secondary" onclick="emailShoppingList()" style="margin-left: 15px;">
                        <i class="fas fa-envelope"></i> Email
                    </button>
                </div>
                <div class="shopping-list" id="shopping-list-content">
                    <!-- Shopping list will be generated by JavaScript -->
                </div>
            </section>
        </div>
    </main>

    <!-- Meal Planning Modal -->
    <div class="modal" id="meal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Plan Your Day</h3>
                <button class="close-btn" onclick="closeMealModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Modal content will be generated by JavaScript -->
            </div>
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn-primary" onclick="saveMealPlan()">
                    <i class="fas fa-save"></i> Save Meal Plan
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentWeekStart = new Date();
        let mealPlans = {};
        let favorites = new Set();
        let selectedDay = null;
        let currentMealSelections = {};

        // Sample meal data
        const mealDatabase = {
            breakfast: [
                { name: "Greek Yogurt with Berries & Honey", ingredients: ["Greek yogurt", "Mixed berries", "Honey", "Walnuts"] },
                { name: "Avocado Toast with Tomatoes", ingredients: ["Whole grain bread", "Avocado", "Cherry tomatoes", "Olive oil", "Sea salt"] },
                { name: "Mediterranean Scrambled Eggs", ingredients: ["Eggs", "Spinach", "Feta cheese", "Olive oil", "Fresh herbs"] },
                { name: "Overnight Oats with Almonds", ingredients: ["Rolled oats", "Almond milk", "Chia seeds", "Sliced almonds", "Cinnamon"] },
                { name: "Smoothie Bowl with Spinach", ingredients: ["Spinach", "Banana", "Greek yogurt", "Almond butter", "Granola"] }
            ],
            lunch: [
                { name: "Mediterranean Quinoa Salad", ingredients: ["Quinoa", "Cucumber", "Tomatoes", "Olives", "Feta cheese", "Olive oil"] },
                { name: "Grilled Chicken & Vegetable Wrap", ingredients: ["Whole wheat tortilla", "Grilled chicken", "Bell peppers", "Hummus", "Lettuce"] },
                { name: "Lentil & Vegetable Soup", ingredients: ["Red lentils", "Carrots", "Celery", "Onion", "Vegetable broth", "Herbs"] },
                { name: "Tuna & White Bean Salad", ingredients: ["Canned tuna", "White beans", "Red onion", "Parsley", "Lemon", "Olive oil"] },
                { name: "Stuffed Bell Peppers", ingredients: ["Bell peppers", "Ground turkey", "Brown rice", "Tomatoes", "Herbs"] }
            ],
            dinner: [
                { name: "Baked Salmon with Herbs", ingredients: ["Salmon fillet", "Lemon", "Dill", "Olive oil", "Asparagus", "Sweet potato"] },
                { name: "Mediterranean Chicken Skewers", ingredients: ["Chicken breast", "Zucchini", "Red onion", "Bell peppers", "Olive oil", "Oregano"] },
                { name: "Vegetarian Stuffed Eggplant", ingredients: ["Eggplant", "Tomatoes", "Onion", "Garlic", "Pine nuts", "Fresh basil"] },
                { name: "Turkey & Vegetable Stir-fry", ingredients: ["Ground turkey", "Broccoli", "Carrots", "Snow peas", "Ginger", "Olive oil"] },
                { name: "Baked Cod with Mediterranean Vegetables", ingredients: ["Cod fillet", "Zucchini", "Tomatoes", "Olives", "Capers", "Herbs"] }
            ],
            snacks: [
                { name: "Hummus with Vegetable Sticks", ingredients: ["Hummus", "Carrots", "Cucumber", "Bell peppers"] },
                { name: "Mixed Nuts & Dried Fruit", ingredients: ["Almonds", "Walnuts", "Dried apricots", "Dates"] },
                { name: "Greek Yogurt with Cucumber", ingredients: ["Greek yogurt", "Cucumber", "Mint", "Olive oil"] },
                { name: "Apple Slices with Almond Butter", ingredients: ["Apple", "Almond butter", "Cinnamon"] },
                { name: "Olives & Cheese", ingredients: ["Kalamata olives", "Feta cheese", "Cherry tomatoes"] }
            ]
        };

        // Wellness tips
        const wellnessTips = [
            "Start your day with a glass of warm water with lemon to boost hydration and support digestion.",
            "Take a 5-minute breathing break every few hours to reduce stress and improve focus.",
            "Include colorful vegetables in every meal for maximum antioxidant benefits.",
            "Try gentle stretching before bed to improve sleep quality and reduce morning stiffness.",
            "Stay socially connected - call a friend or family member today for emotional wellness.",
            "Practice gratitude by writing down three things you're thankful for each morning.",
            "Choose whole grains over refined ones to maintain steady energy levels throughout the day."
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
            updateDailyTip();
            loadFavorites();
            setCurrentWeek();
        });

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Calendar functions
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            calendarGrid.innerHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(currentWeekStart);
                dayDate.setDate(currentWeekStart.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.onclick = () => openMealModal(dayDate);
                
                const dayKey = dayDate.toDateString();
                const mealCount = mealPlans[dayKey] ? Object.keys(mealPlans[dayKey]).length : 0;
                
                dayElement.innerHTML = `
                    <div class="day-number">${dayDate.getDate()}</div>
                    <div style="font-size: 0.9rem; color: #666;">${days[i]}</div>
                    <div class="meal-indicators">
                        ${Array(mealCount).fill('<div class="meal-dot"></div>').join('')}
                    </div>
                `;
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function setCurrentWeek() {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-week').textContent = 
                `Week of ${currentWeekStart.toLocaleDateString('en-US', options)}`;
        }

        function previousWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            generateCalendar();
            setCurrentWeek();
        }

        function nextWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            generateCalendar();
            setCurrentWeek();
        }

        // Meal planning modal functions
        function openMealModal(date) {
            selectedDay = date.toDateString();
            const modal = document.getElementById('meal-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = `Plan meals for ${date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}`;
            
            // Load existing meal plan or create empty one
            currentMealSelections = mealPlans[selectedDay] || {};
            
            modalBody.innerHTML = generateMealSections();
            modal.classList.add('active');
        }

        function generateMealSections() {
            const mealTypes = ['breakfast', 'lunch', 'dinner', 'snacks'];
            let html = '';
            
            mealTypes.forEach(mealType => {
                html += `
                    <div class="meal-section">
                        <h4>${mealType.charAt(0).toUpperCase() + mealType.slice(1)}</h4>
                        <div class="meal-options">
                            ${mealDatabase[mealType].map((meal, index) => `
                                <div class="meal-option ${currentMealSelections[mealType] === meal.name ? 'selected' : ''}" 
                                     onclick="selectMeal('${mealType}', '${meal.name}', this)">
                                    <div>
                                        <strong>${meal.name}</strong>
                                        <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                                            ${meal.ingredients.slice(0, 3).join(', ')}${meal.ingredients.length > 3 ? '...' : ''}
                                        </div>
                                    </div>
                                    <button class="favorite-btn ${favorites.has(meal.name) ? 'favorited' : ''}" 
                                            onclick="toggleFavorite('${meal.name}', event)">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        function selectMeal(mealType, mealName, element) {
            // Remove selection from other options in this meal type
            element.parentNode.querySelectorAll('.meal-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select this option
            element.classList.add('selected');
            currentMealSelections[mealType] = mealName;
        }

        function toggleFavorite(mealName, event) {
            event.stopPropagation();
            const button = event.target.closest('.favorite-btn');
            
            if (favorites.has(mealName)) {
                favorites.delete(mealName);
                button.classList.remove('favorited');
            } else {
                favorites.add(mealName);
                button.classList.add('favorited');
            }
            
            saveFavorites();
            loadFavorites();
        }

        function saveMealPlan() {
            mealPlans[selectedDay] = { ...currentMealSelections };
            closeMealModal();
            generateCalendar();
        }

        function closeMealModal() {
            document.getElementById('meal-modal').classList.remove('active');
        }

        // Surprise me function
        function surpriseMe() {
            const days = 7;
            for (let i = 0; i < days; i++) {
                const dayDate = new Date(currentWeekStart);
                dayDate.setDate(currentWeekStart.getDate() + i);
                const dayKey = dayDate.toDateString();
                
                mealPlans[dayKey] = {
                    breakfast: getRandomMeal('breakfast'),
                    lunch: getRandomMeal('lunch'),
                    dinner: getRandomMeal('dinner'),
                    snacks: getRandomMeal('snacks')
                };
            }
            generateCalendar();
            alert('Your week has been planned with delicious Mediterranean-inspired meals!');
        }

        function getRandomMeal(mealType) {
            const meals = mealDatabase[mealType];
            return meals[Math.floor(Math.random() * meals.length)].name;
        }

        // Shopping list functions
        function generateShoppingList() {
            const ingredients = {};
            
            // Collect all ingredients from the week's meal plans
            Object.values(mealPlans).forEach(dayPlan => {
                Object.values(dayPlan).forEach(mealName => {
                    const meal = findMealByName(mealName);
                    if (meal) {
                        meal.ingredients.forEach(ingredient => {
                            ingredients[ingredient] = (ingredients[ingredient] || 0) + 1;
                        });
                    }
                });
            });
            
            displayShoppingList(ingredients);
        }

        function findMealByName(mealName) {
            for (const mealType in mealDatabase) {
                const meal = mealDatabase[mealType].find(m => m.name === mealName);
                if (meal) return meal;
            }
            return null;
        }

        function displayShoppingList(ingredients) {
            const categories = {
                'Produce': ['Spinach', 'Tomatoes', 'Cucumber', 'Bell peppers', 'Carrots', 'Onion', 'Garlic', 'Lemon', 'Avocado', 'Mixed berries', 'Apple', 'Zucchini', 'Asparagus', 'Broccoli', 'Snow peas', 'Cherry tomatoes', 'Red onion', 'Celery', 'Sweet potato', 'Lettuce', 'Fresh herbs', 'Dill', 'Fresh basil', 'Mint', 'Parsley'],
                'Protein': ['Greek yogurt', 'Eggs', 'Grilled chicken', 'Chicken breast', 'Ground turkey', 'Salmon fillet', 'Cod fillet', 'Canned tuna'],
                'Dairy': ['Feta cheese', 'Almond milk'],
                'Grains & Legumes': ['Whole grain bread', 'Quinoa', 'Whole wheat tortilla', 'Red lentils', 'White beans', 'Brown rice', 'Rolled oats'],
                'Pantry': ['Olive oil', 'Honey', 'Sea salt', 'Hummus', 'Vegetable broth', 'Almond butter', 'Chia seeds', 'Cinnamon', 'Oregano', 'Ginger', 'Pine nuts', 'Granola'],
                'Nuts & Dried Fruits': ['Walnuts', 'Sliced almonds', 'Almonds', 'Dried apricots', 'Dates'],
                'Other': ['Olives', 'Kalamata olives', 'Capers']
            };
            
            const shoppingListContent = document.getElementById('shopping-list-content');
            let html = '';
            
            Object.entries(categories).forEach(([category, categoryItems]) => {
                const categoryIngredients = Object.entries(ingredients).filter(([ingredient]) => 
                    categoryItems.some(item => item.toLowerCase().includes(ingredient.toLowerCase()) || 
                                             ingredient.toLowerCase().includes(item.toLowerCase()))
                );
                
                if (categoryIngredients.length > 0) {
                    html += `
                        <div class="shopping-category">
                            <h4>${category}</h4>
                            ${categoryIngredients.map(([ingredient, quantity]) => `
                                <div class="shopping-item">
                                    <span>${ingredient}</span>
                                    <span>${quantity > 1 ? `(${quantity})` : ''}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            shoppingListContent.innerHTML = html || '<p style="text-align: center; color: #666;">No meals planned yet. Start planning your week to generate a shopping list!</p>';
        }

        function printShoppingList() {
            window.print();
        }

        function emailShoppingList() {
            alert('Email functionality would be implemented with a backend service. For now, you can copy the list manually.');
        }

        // Favorites functions
        function saveFavorites() {
            localStorage.setItem('darcyFavorites', JSON.stringify([...favorites]));
        }

        function loadFavorites() {
            const saved = localStorage.getItem('darcyFavorites');
            if (saved) {
                favorites = new Set(JSON.parse(saved));
            }
            displayFavorites();
        }

        function displayFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            
            if (favorites.size === 0) {
                favoritesGrid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">No favorite meals yet. Start exploring and heart the meals you love!</p>';
                return;
            }
            
            let html = '';
            favorites.forEach(mealName => {
                const meal = findMealByName(mealName);
                if (meal) {
                    html += `
                        <div class="favorite-card">
                            <h4>${meal.name}</h4>
                            <p style="color: #666; margin-bottom: 15px;">
                                Ingredients: ${meal.ingredients.join(', ')}
        
